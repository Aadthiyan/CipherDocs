services:
  - type: web
    name: cipherdocs-backend
    runtime: python
    buildCommand: pip install -r requirements.txt && alembic upgrade head
    startCommand: gunicorn main:app --worker-class uvicorn.workers.UvicornWorker --workers 1 --bind 0.0.0.0:$PORT --timeout 600 --graceful-timeout 120 --log-level info
    plan: standard
    envVars:
      # Application settings
      - key: ENVIRONMENT
        value: production
      - key: DEBUG
        value: "false"
      - key: LOG_LEVEL
        value: INFO
      
      # Database (from Neon)
      - key: DATABASE_URL
        sync: false  # Set in Render dashboard from your Neon connection string
      
      # Redis (Using Upstash - cloud-hosted)
      - key: REDIS_URL
        sync: false  # Set in Render dashboard from your Upstash console
      
      # Frontend CORS
      - key: CORS_ORIGINS
        value: "https://cipherdocs.vercel.app,http://localhost:3000"
      
      # CyborgDB Embedded Configuration
      - key: CYBORGDB_BACKING_STORE
        value: "postgresql"  # Use PostgreSQL for persistence across worker restarts
      
      # LLM Configuration
      - key: LLM_ANSWER_GENERATION_ENABLED
        value: "true"
      - key: GROQ_MODEL
        value: "openai/gpt-oss-120b"
      - key: LLM_MAX_TOKENS
        value: "1500"
      - key: LLM_TEMPERATURE
        value: "0.3"
      
      # Secrets (set in Render dashboard)
      - key: JWT_SECRET_KEY
        sync: false
      - key: GROQ_API_KEY
        sync: false
      - key: MASTER_ENCRYPTION_KEY
        sync: false
